<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
</head>
<body>
    <h3>Hola <span id="nom"></span></h3>
    <br>
    <h2>Alunas preguntas, para que la aplicación funcione mejor.</h2>
    <br>
    <form action="">
        <h3><label for="pierna">¿Zurdo o diestro?</label></h3>
        <select name="derechaIzquierda" id="pierna" required>
            <option value="0" selected="selected">Elija una opción</option>
            <option value="zurdo">Zurdo</option>
            <option value="diestro">Diestro</option>
            <option value="ambi">Ambidiestro</option> 
        </select>
        <!--
        <h3><label for="pieFreno">¿Con que pie sueles frenar?</label></h3>
        <select name="pieFrenada" id="pieFreno">
            <option value="0" selected="selected">Elija una opción</option>
            <option value="izquierdo">Izquierdo</option>
            <option value="derecho">Derecho</option>
            <option value="ambos">Ambos</option>
        </select>
        -->
        <h3><label for="formaFrenar">¿Cómo sueles frenar?</label></h3>
        <select name="forma" id="formaFrenar">
            <option value="0" selected="selected">Elija una opción</option>
            <option value="t">En T</option>
            <option value="v">En V</option>
            <option value="taco">Con taco</option>
            <option value="etc">Un poco de todo</option>
        </select>
        <h3><label for="tipoRueda">Selecciona la dureza de las ruedas.</label></h3>
        <select name="durezaRuedas" id="tipoRueda" required>
            <option value="0" selected="selected">Elija una opción</option>
            <option value="74">74A</option>
            <option value="78">78A</option>
            <option value="82">82A</option> 
            <option value="85">85A</option>
            <option value="88">88A</option>
            <option value="90">90A</option>
            <option value="100">100A</option>
            <option value="No">No lo se</option>
        </select>
        <br>
        <input type="button" value="Enviar" id="enviar">
    </form>
    <div id="confirmacion"></div>
    <script>
        //var buscaUsuario = null;
        var usuario = null;
        var nombre = "";
        window.onload = compruebaUsuario;
        //window.onload = iniciar;
        function compruebaUsuario(){
            var encontrado = false;
            var i = 0;
            while(!encontrado){
                usuario = JSON.parse(localStorage.getItem( localStorage.key(i)));
                //Quizas tengo que comprobar si es un objeto
                if(usuario.haEntrado){
                    nombre = localStorage.key(i);
                    usuario.haEntrado = false;
                    localStorage.setItem(nombre, JSON.stringify(usuario));
                    encontrado = true;
                    //alert(nombre);
                    document.getElementById("nom").innerHTML = nombre;
                }
                i++;
            }
            function chekeo(){
                if(document.getElementById("pierna").value != 0 &&
                     document.getElementById("formaFrenar").value != 0 &&
                      document.getElementById("tipoRueda").value != 0){
                    //Patin izquierdo son indices 0, 1 y 2
                    if(document.getElementById("pierna").value =="zurdo"){
                        var tabla = usuario.valoresDeDesgaste.slice();
                        for(var j = 0 ; j < 3 ; j++){
                            for(var k = 0 ; k < 2 ; k++){
                                tabla[j][k] = tabla[j][k] + 15;
                            }
                        }
                        usuario.valoresDeDesgaste = tabla.slice();
                    }
                    //Patin derecho son indices 3, 4 y 5
                    if(document.getElementById("pierna").value =="diestro"){
                        var tabla = usuario.valoresDeDesgaste.slice();
                        for(var j = 3 ; j < 6 ; j++){
                            for(var k = 0 ; k < 2 ; k++){
                                tabla[j][k] = tabla[j][k] + 15;
                            }
                        }
                        usuario.valoresDeDesgaste = tabla.slice();
                    }
                    //Si frena en t y es zurdo, incrementa desgaste interior del pie izquierdo
                    if(document.getElementById("formaFrenar").value =="t" && document.getElementById("pierna").value =="zurdo"){
                        usuario.valoresDeDesgaste[0][1] = usuario.valoresDeDesgaste[0][1] + 20;
                        usuario.valoresDeDesgaste[1][1] = usuario.valoresDeDesgaste[1][1] + 20;
                        usuario.valoresDeDesgaste[2][1] = usuario.valoresDeDesgaste[2][1] + 20;
                    }
                    //Si frena en t y es diestro, incrementa desgaste interior del pie derecho
                    if(document.getElementById("formaFrenar").value =="t" && document.getElementById("pierna").value =="diestro"){
                        usuario.valoresDeDesgaste[3][1] = usuario.valoresDeDesgaste[3][1] + 20;
                        usuario.valoresDeDesgaste[4][1] = usuario.valoresDeDesgaste[4][1] + 20;
                        usuario.valoresDeDesgaste[5][1] = usuario.valoresDeDesgaste[5][1] + 20;
                    }
                    //Si frena en V ambos patines incrementan desgaste exterior
                    if(document.getElementById("formaFrenar").value =="v"){
                        usuario.valoresDeDesgaste[0][0] = usuario.valoresDeDesgaste[0][0] + 10;
                        usuario.valoresDeDesgaste[1][0] = usuario.valoresDeDesgaste[1][0] + 10;
                        usuario.valoresDeDesgaste[2][0] = usuario.valoresDeDesgaste[2][0] + 10;
                        usuario.valoresDeDesgaste[3][0] = usuario.valoresDeDesgaste[3][0] + 10;
                        usuario.valoresDeDesgaste[4][0] = usuario.valoresDeDesgaste[4][0] + 10;
                        usuario.valoresDeDesgaste[5][0] = usuario.valoresDeDesgaste[5][0] + 10;
                    }
                    //La primera vez, el desgaste acumulado es igual a los valores de desgaste.
                    usuario.acumuladoDesgaste = usuario.valoresDeDesgaste.slice();
                    usuario.haEntrado = true;
                    usuario.haCompletadoFormulario = true;
                    localStorage.setItem(nombre, JSON.stringify(usuario));
                    window.open("cambiaRuedas.html","_self");
                }else{
                    document.getElementById("confirmacion").innerHTML ="Falta alguna opción por elegir";
                }
            }
            document.getElementById("enviar").addEventListener('click', chekeo, false);
        }
        /*
        lol2 = JSON.parse(localStorage.getItem( localStorage.key(i))); // esto devuelve el contenido de la key del indice indicado (el objeto)!!!!!!IMPORTANTE!!!!!!!!

        alert(localStorage.key(i));//Esto da el nombre la key en sí. Con esto comprueba si el nombre ya se ha metido!!!!!!IMPORTANTE!!!!!!!!
        */
    </script>
</body>
</html>